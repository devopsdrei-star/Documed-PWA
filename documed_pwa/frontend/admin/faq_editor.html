<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>FAQ Editor - DocuMed</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:16px}
    textarea{width:100%;height:320px;font-family:monospace}
    .row{display:flex;gap:8px}
    button{padding:8px 12px}
    .msg{margin-top:8px}
  </style>
</head>
<body>
  <h1>FAQ Editor</h1>
  <p>Load, edit, and save the fallback FAQ JSON. Requires admin session or Authorization Bearer token.</p>
  <div class="row">
    <button id="loadBtn">Load</button>
    <button id="saveBtn">Save</button>
    <input id="token" placeholder="Optional: Bearer token" style="flex:1" />
  </div>
  <div style="margin-top:12px">
    <textarea id="editor" placeholder="{"type="application/json"></textarea>
  </div>
  <div class="msg" id="msg"></div>

  <script>
    const loadBtn = document.getElementById('loadBtn');
    const saveBtn = document.getElementById('saveBtn');
    const editor = document.getElementById('editor');
    const msg = document.getElementById('msg');
    const tokenInput = document.getElementById('token');

    function show(m, ok=true){ msg.textContent = m; msg.style.color = ok ? 'green' : 'crimson'; }

    async function api(path, method='GET', body=null){
      const headers = {};
      const t = tokenInput.value.trim();
      if (t) headers['Authorization'] = 'Bearer ' + t;
      if (body !== null) headers['Content-Type'] = 'application/json';
      const res = await fetch(path, {method, headers, body: body !== null ? JSON.stringify(body) : undefined, credentials: 'include'});
      return res.json();
    }

    loadBtn.addEventListener('click', async ()=>{
      try{
        const r = await api('/documed_pwa/backend/api/faq_admin.php');
        if (r.success){ editor.value = JSON.stringify(r.faq, null, 2); show('Loaded'); }
        else show('Error: ' + (r.error || r.message), false);
      }catch(e){ show('Network error', false); }
    });

    saveBtn.addEventListener('click', async ()=>{
      try{
        let parsed;
        try{ parsed = JSON.parse(editor.value); } catch(e){ show('Invalid JSON: ' + e.message, false); return; }
        const r = await api('/documed_pwa/backend/api/faq_admin.php', 'POST', {faq: parsed});
        if (r.success) show('Saved'); else show('Error: ' + (r.error || r.message), false);
      }catch(e){ show('Network error', false); }
    });

    // Auto-load on open to help small edits
    loadBtn.click();
  </script>
</body>
</html>
